<!DOCTYPE html>
<html>
    <head>
        <title>DB-Einfuegen</title>
        <meta charset="UTF-8">
        <style>
            body {font-family: Arial, Helvetica, sans-serif;}
            * {box-sizing: border-box;}

            .form-container input[type=text]{
                padding: 10px;
                margin: 5px 0 10px 0;
                border: none;
                background: #f1f1f1;
            }

            input#name{
                position: relative;
                left: 30px;
            }

            input#price{
                position: relative;
                left: 77px;

            }

            input#picturelink{
                position: relative;
                left: 55px;
            }

            input#description{
                position: relative;
                left: 15px;
            }
            div.errorDescr{
                color: red;
                display: none;
            }
        </style>
        <script src="http://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous">
        //jquery einbinden
        </script>
    </head>
    <body>
        <form action="./insert.php" method="GET" class="form-container" id="myForm"> <!--Method sollte später POST sein-->
        <label for="name">Artikelname:</label><input name="name" id="name" type="text" size="15" maxlength="30" placeholder="Name" title="Name des Artikels"><div class="errorDescr" id="nameExisting">Der Artikelname existiert bereits.</div><div class="errorDescr" id="nameError">Bitte gebe Sie kein ' ein.</div><br>
        <label for="price">Preis:</label><input name="price" id="price" type="text" size="4" maxlength="7" placeholder="0000.00" title="Preis des Artikels"><div class="errorDescr" id="priceError">Bitte geben Sie einen anständigen Preis an.</div><br>
        <label for="picturelink">Bildpfad:</label><input name="picturelink" id="picturelink" type="text" size="30" maxlength="70" placeholder="C:\Beispielpfad\Beispielbild.png" title="Dateipfad des Artikelbildes"><div class="errorDescr" id="picturelinkExisting">Der Artikelname existiert bereits.</div><div class="errorDescr" id="picturelinkError">Bitte gebe Sie kein ' ein.</div><br>
        <label for="description">Beschreibung:</label><input name="description" id="description" type="text" placeholder="Dies ist ein Artikel" title="Artikelbeschreibung"><div class="errorDescr" id="descriptionError">Bitte gebe Sie kein ' ein.</div><br>
        <input type="button" value="Reinpumpen" onclick="validate()">
        </form>
        <script>

            function submitForm()
            {
                document.getElementById("myForm").submit();
            }

            function resetUI()
            {
                var errorDescrs = document.getElementsByClassName("errorDescr");
                for(var i = 0;i<errorDescrs.length;i++)
                {
                    errorDescrs[i].style.display = "none";
                }
            }

            const validate = () => {
                //Reset UI
                resetUI();

                const name = document.getElementById("name").value;
                const price = document.getElementById("price").value;
                const picturelink = document.getElementById("picturelink").value;
                const description = document.getElementById("description").value;
                
                const REGEX = /^[^']*$/;
                const priceREGEX = /^[0-9]{1,4}([.][0-9]{2})?$/;
                
                var error_exists = false;
                if(!REGEX.test(name))
                {
                    document.getElementById("nameError").style.display = "block";
                    error_exists = true;
                }
                if(!priceREGEX.test(price))
                {
                    document.getElementById("priceError").style.display = "block";
                    error_exists = true;
                }
                if(!REGEX.test(picturelink))
                {
                    document.getElementById("picturelinkError").style.display = "block";
                    error_exists = true;
                }
                if(!REGEX.test(description))
                {
                    document.getElementById("descriptionError").style.display = "block";
                    error_exists = true;
                }

                if(error_exists)
                {
                    return;
                }
                
                var a = $.ajax({
                type: "GET",
                url: 'Functions/validateArtikel.php',
                data: { name: name,
                        picturelink: picturelink,
                      },
                async: true
            }).done(function(data){
                //alert('Antwort: ' + data);
                
                if(data == 0)
                {
                    //alert('Kein Fehler');
                    submitForm();
                }
                else if(data == 1){
                    //alert('Der Artikelname und Bild sind bereits vorhanden');
                    document.getElementById("nameExisting").style.display = "block";
                    document.getElementById("picturelinkExisting").style.display = "block";
                }
                else if(data == 2){
                    //alert('Der Artikelname existiert bereits');
                    document.getElementById("nameExisting").style.display = "block";
                }
                else if(data == 3)
                {
                    //alert('Der Bildpfad existiert bereits');
                    document.getElementById("picturelinkExisting").style.display = "block";
                }
                else{
                    alert('Kommunikation zwischen validateArtikel und hier stimmt nicht. Data = ' + data);
                }
            });
            
            }
        </script>
    </body>
</html>